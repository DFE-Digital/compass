@model FipsReporting.Models.AdminPerformanceMetricsViewModel

@{
    ViewData["Title"] = "Performance Metrics Management";
    ViewData["ActiveNav"] = "admin";
    ViewData["ActiveNavItem"] = "manage-metrics";
}

@section BeforeContent {
    <div class="dfe-masthead dfe-masthead--with-links">
        <div class="govuk-width-container">
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-full">
                    <span class="govuk-caption-l govuk-!-margin-top-6">COMPASS admin</span>
                    <h1 class="govuk-heading-xl">Manage metrics</h1>
                    </div>
            </div>
        </div>
    </div>
}

<div class="govuk-grid-row">
            <!-- Vertical Navigation -->
            <div class="govuk-grid-column-one-quarter">
                <nav class="dfe-vertical-nav" data-module="dfe-vertical-nav">
                    <ul class="dfe-vertical-nav__section">
                        <li class="dfe-vertical-nav__section-item @(ViewData["ActiveNavItem"]?.ToString() == "dashboard" ? "dfe-vertical-nav__section-item--current" : "")">
                            <a class="dfe-vertical-nav__link govuk-link govuk-link--no-visited-state govuk-link--no-underline" href="@Url.Action("Index", "Admin")">
                                Dashboard
                            </a>
                        </li>
                        <li class="dfe-vertical-nav__section-item @(ViewData["ActiveNavItem"]?.ToString() == "manage-metrics" ? "dfe-vertical-nav__section-item--current" : "")">
                            <a class="dfe-vertical-nav__link govuk-link govuk-link--no-visited-state govuk-link--no-underline" href="@Url.Action("Index", "AdminPerformanceMetrics")">
                                Manage metrics
                            </a>
                        </li>
                        <li class="dfe-vertical-nav__section-item @(ViewData["ActiveNavItem"]?.ToString() == "manage-users" ? "dfe-vertical-nav__section-item--current" : "")">
                            <a class="dfe-vertical-nav__link govuk-link govuk-link--no-visited-state govuk-link--no-underline" href="@Url.Action("Index", "AdminUser")">
                                Manage users
                            </a>
                        </li>
                        <li class="dfe-vertical-nav__section-item @(ViewData["ActiveNavItem"]?.ToString() == "manage-objectives" ? "dfe-vertical-nav__section-item--current" : "")">
                            <a class="dfe-vertical-nav__link govuk-link govuk-link--no-visited-state govuk-link--no-underline" href="@Url.Action("Index", "AdminObjectives")">
                                Manage objectives
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="govuk-grid-column-three-quarters">
                <!-- Actions Bar -->
                <div class="govuk-grid-row govuk-!-margin-bottom-4">
                    <div class="govuk-grid-column-two-thirds">
                        <div class="govuk-form-group">
                            <label class="govuk-label" for="metrics-search">Search metrics</label>
                            <input class="govuk-input" id="metrics-search" name="search" type="text" placeholder="Search by name or reference">
                        </div>
                    </div>
                    <div class="govuk-grid-column-one-third">
                        <div class="govuk-form-group">
                            <label class="govuk-label" for="mandate-filter">Filter by mandate</label>
                            <select class="govuk-select" id="mandate-filter">
                                <option value="">All mandates</option>
                                <option value="legal">Legal</option>
                                <option value="dsit">DSIT</option>
                                <option value="dfe">DfE</option>
                                <option value="ddt">DDT</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="govuk-grid-row">
                    <div class="govuk-grid-column-full">
                        @if (Model.Metrics.Any())
                        {
                            <div class="govuk-summary-card">
                                <div class="govuk-summary-card__title-wrapper">
                                    <h2 class="govuk-summary-card__title">
                                        Performance metrics
                                    </h2>
                                    <ul class="govuk-summary-card__actions">
                                        <li class="govuk-summary-card__action">
                                            <a class="govuk-link" href="@Url.Action("Create", "AdminPerformanceMetrics")">
                                                Add new metric<span class="govuk-visually-hidden"> to performance metrics</span>
                                            </a>
                                        </li>
                                        <li class="govuk-summary-card__action">
                                            <a class="govuk-link" href="@Url.Action("Export", "AdminPerformanceMetrics")">
                                                Export<span class="govuk-visually-hidden"> performance metrics</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="govuk-summary-card__content">
                                    <table class="govuk-table" data-module="moj-sortable-table">
                                        <thead class="govuk-table__head">
                                            <tr class="govuk-table__row">
                                                <th class="govuk-table__header" scope="col">Metric</th>
                                                <th class="govuk-table__header" scope="col">Mandate</th>
                                                <th class="govuk-table__header" scope="col">Category</th>
                                            </tr>
                                        </thead>
                                        <tbody class="govuk-table__body">
                                            @foreach (var metric in Model.Metrics.OrderBy(m => m.Category).ThenBy(m => m.Name))
                                            {
                                                <tr class="govuk-table__row" data-mandate="@metric.Mandate.ToLower()" data-name="@metric.Name.ToLower()" data-fips="@metric.FipsId.ToLower()">
                                                    <td class="govuk-table__cell">
                                                        <a href="@Url.Action("Details", "AdminPerformanceMetrics", new { id = metric.Id })" class="govuk-link">
                                                            @metric.Name
                                                        </a>
                                                        <br>
                                                        <span class="govuk-body-s govuk-!-font-weight-regular">@metric.FipsId</span>
                                                    </td>
                                                    <td class="govuk-table__cell">
                                                        @if (metric.Mandate == "Legal")
                                                        {
                                                            <span class="govuk-tag govuk-tag--blue">Legal</span>
                                                        }
                                                        else if (metric.Mandate == "DSIT")
                                                        {
                                                            <span class="govuk-tag govuk-tag--purple">DSIT</span>
                                                        }
                                                        else if (metric.Mandate == "DfE")
                                                        {
                                                            <span class="govuk-tag govuk-tag--green">DfE</span>
                                                        }
                                                        else if (metric.Mandate == "DDT")
                                                        {
                                                            <span class="govuk-tag govuk-tag--orange">DDT</span>
                                                        }
                                                        else
                                                        {
                                                            <span class="govuk-tag govuk-tag--grey">@metric.Mandate</span>
                                                        }
                                                    </td>
                                                    <td class="govuk-table__cell">
                                                        @metric.Category
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="govuk-inset-text">
                                <p class="govuk-body">No performance metrics found.</p>
                                <p class="govuk-body">
                                    <a href="@Url.Action("Create", "AdminPerformanceMetrics")" class="govuk-link">
                                        Add your first metric â†’
                                    </a>
                                </p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

    <script nonce="@Html.GetNonce()">
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('metrics-search');
            const mandateFilter = document.getElementById('mandate-filter');
            const tableRows = document.querySelectorAll('.govuk-table__row[data-name]');

            function filterRows() {
                const searchTerm = searchInput.value.toLowerCase();
                const mandateValue = mandateFilter.value.toLowerCase();

                tableRows.forEach(row => {
                    const name = row.getAttribute('data-name');
                    const fips = row.getAttribute('data-fips');
                    const mandate = row.getAttribute('data-mandate');

                    const matchesSearch = name.includes(searchTerm) || fips.includes(searchTerm);
                    const matchesMandate = !mandateValue || mandate.includes(mandateValue);

                    if (matchesSearch && matchesMandate) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }

            searchInput.addEventListener('input', filterRows);
            mandateFilter.addEventListener('change', filterRows);

            // Export functionality
            document.getElementById('export-metrics').addEventListener('click', function() {
                alert('Export functionality would be implemented here');
            });
        });
    </script>